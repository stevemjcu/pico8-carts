pico-8 cartridge // http://www.pico-8.com
version 35
__lua__

-- #

-- king crab
-- by zapp

--[[
footprints
seashells
birds
beach ball
shader
submerge effect
collision
shadows
physics
--]]

-- #

function cat(a,b)
 for k,v in pairs(b) do
  a[k]=v
 end
end

function box(x,y,w,h)
 return {x=x,y=y,w=w,h=h}
end

function vel(dx,dy)
 return {dx=dx,dy=dy}
end

function acc(ddx,ddy)
	return {ddx=ddx,ddy=ddy}
end

-- #

function mag(x,y)
 return sqrt(x*x+y*y)
end

function nor(x,y)
 local m=mag(x,y)
 if(m==0) return 0,0
 return x/m,y/m
end

function aabb(a,b)
 return not (
  (a.x>b.x+b.w) or
  (a.x+a.w<b.x) or
  (a.y>b.y+b.w) or
  (a.y+a.w<b.y)
 )
end

-- #

function move(el)
 for e in all(el) do
  e.dx+=e.ddx e.dy+=e.ddy
  e.x+=e.dx e.y+=e.dy
  e.dx*=0.7 e.dy*=0.7
 end
end

-- #

function _init()
 el={}
 p={}
 cat(p,box(76,76,8,8))
 cat(p,vel(0,0))
 cat(p,acc(0,0))
 add(el,p)
 s={}
 cat(s,box(60,60,8,8))
 cat(s,vel(0,0))
 cat(s,acc(0,0))
 add(el,s)
end

function _update()
 p.ddx,p.ddy=0,0
 if(btn(⬆️)) p.ddy=-1
 if(btn(⬇️)) p.ddy=1
 if(btn(⬅️)) p.ddx=-1
 if(btn(➡️)) p.ddx=1
 p.ddx,p.ddy=nor(p.ddx,p.ddy)
 p.ddx*=0.5 p.ddy*=0.5
 move(el)
end

function _draw()
 local x,y=0,0
 cls(15)
 x,y=s.x,s.y
 spr(15,x,y)
  for y=0,127 do
   x=sin((t()+y/127)/12)
   x=((x+1)/2*128)+y
   line(x,y,x+128,y,12)
   line(x,y,x+8,y,7)
  end
 x,y=p.x,p.y
 n=flr(t()%2)
 spr(16,x,y)
 if(mag(p.dx,p.dy)>0) do
  y-=flr(t()*15)%2
 end
 spr(1+n,x,y)
 spr(17+flr(t())%2,x,y)
 spr(17+flr(t()+1)%2,x,y,1,1,true)
 shader()
 debug()
end

-- #

function shader()
end

function debug()
 color(11);
 print("colliding:"..tonum(aabb(p,s)))
end

-- #

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e2ee2e0
0070070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000eeee2e0
0007700000200200002002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000eeeeee0
0007700008888880088888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000eeee2e0
00700700088888800888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002eeee20
00000000808888088088880800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000222200
00000000008008000080080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000800000008800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000
00000000880000008800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003003000
00000000800000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030003000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030030000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030033
05555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300300
00555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
